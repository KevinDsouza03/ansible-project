trigger:
- main

pool:
  name: 'Default'

variables:
  - name: ssh_password
    value: $(SSH_PASSWORD)

stages:
- stage: RunAnsible
  jobs: 
  - job: RunPlaybookOnHosts
    steps:
    - script: |
        echo "Creating Ansible Vault File"
        echo "my_key: $(SSH_PASSWORD" > secret.yml
        ansible-vault encrypt secret.yml --vault-password-file vault_pass.txt
        
        echo "Running Ansible playbook..."
        
        export ANSIBLE_HOST_KEY_CHECKING=False
        ansible-playbook /home/kdsouza/Project/playbook-test.yml --vault-password-file vault_pass.txt -vvvv

        # ansible-playbook /home/kdsouza/Project/playbook-test.yml -vvvv
      env: 
        SSH_PASSWORD: $(SSH_PASSWORD)
      displayName: Run Ansible Playbook
